<?xml version="1.0"?>
<entitytype name="Dragon" id="dragon">
    <functions>
        <function name="tick">
            import random
        
            def dragon_tick(index, entity):
                if random.random() &lt;= 0.1:
                    # wander
                    possib = set()
                    
                    for p in self.world.paths:
                        if entity.place in p:
                            possib.add(p)
                            
                    if len(possib) &gt; 0:
                        entity.place = random.choice(tuple(possib))
        </function>
        
        <function name="fly">
            def dragon_fly(index, entity):
                if entity['destination'] == entity.place:
                    return False
                    
                i = 3
                
                while entity['destination'] != entity.place and i &gt; 0:
                    i -= 1
                    entity.call('pathmove', entity['destination'])
                    
                return i &gt; 0
        </function> 
        
        <function name="slash">
            def dragon_slash(index, entity):
                if entity.attr['target'] is None:
                    return
                    
                if self.world.from_id(entity.attr['target']).size &lt; entity.variant['size']:
                    return
                    
                entity.call('attack', world.from_id(entity['target']), __import__('random').uniform(30, 50))
        </function>
        
        <function name="firebreath">
            import random
        
            def dragon_fire(index, entity):
                if entity.attr['target'] is None:
                    return
                    
                if self.world.from_id(entity.attr['target'])['size'] &gt;= entity['size']:
                    return
                    
                for _ in range(6):
                    entity.call('attack', world.from_id(entity['target']),  __import__('random').uniform(10, 25))
                    
                if world.from_id(entity['target'])['flammable'] and random.random() &lt;= 0.625:
                    entity.world.broadcast(entity, " lit ", world.from_id(entity['target']), " on flames!")
                    world.from_id(entity['target'])['burning'] = True
        </function>
    </functions>
    
    <base>
        <flag name="hasMelee" />
        <flag name="hasRanged" />
        <attr name="meleeAttackFunc" value="'slash'" /> <!-- function called when attacking a close enemy (larger enemies) -->
        <attr name="rangedAttackFunc" value="'firebreath'" /> <!-- function called when attacking a far enemy (smaller enemies) -->
        
        <!-- reactive and social traits, in a scale from 1 to 10 -->
        <attr name="hostility" value="2.25" /> <!-- negativity of reaction to living entities of other kinds --> 
        <attr name="courage" value="8" /> <!-- likelihood to stay when underwhelmed or outnumbered -->
        <attr name="sociality" value="6" /> <!-- likelihood to form 'friends' (will tend to follow each other and share friends and enemies) -->
        <attr name="leadership" value="7.2" /> <!-- likelihood to become leader (most likely to be followed by friends) -->
        <attr name="dangerousness" value="100" /> <!-- Poor sheep... I wonder if we should give them some attack. Old Sentient Mushes IRCRPG (MushyBot/SMBot) used to let animals fight back as well. -->
        
        <!-- kinetic (movement & combat) attributes -->
        <attr name="specialMoveFunc" value="'fly'" /> <!-- special movement is used when hunting, chasing or fleeing -->
        <attr name="speed" value="0.3" /> <!-- likelihood to evade enemy attacks, from 0 to 1 -->
        <attr name="moveSpeed" value="0.8" /> <!-- chance, from 0 to 1, for a succesful tile move -->
    </base>
    
    <default>
        <import name="creatureattr" href="attributes/creatureattr.xml" />
        <attribute key="drops" value="{'scale': (1, 3)}" />
    </default>
    
    <systems>
        <system name="creature" href="systems/creature.py" />
        <system name="drops" href="systems/drops.py" />
    </systems>
    
    <itemdefs>
        <item name="scale" />
    </itemdefs>
    
    <variants>
        <variant name="Baby Dragon" id="baby">
            <attr name="size" value="1.2" />
            <attr name="health" value="160" />
            <attr name="weight" value="45" /> <!-- in kilograms -->
            <flag name="baby" />
        </variant>
    
        <variant name="Small Dragon" id="small">
            <attr name="size" value="2.5" />
            <attr name="health" value="280" />
            <attr name="weight" value="78" /> <!-- in kilograms -->
        </variant>
        
        <variant name="Intelligent Small Dragon" id="small_m">
            <attr name="size" value="2.5" />
            <attr name="health" value="280" />
            <attr name="weight" value="78" /> <!-- in kilograms -->
            <default key="mush" value="True" />
        </variant>
        
        <variant name="Medium-sized Dragon" id="medium">
            <attr name="size" value="4" />
            <attr name="health" value="350" />
            <attr name="weight" value="138" /> <!-- in kilograms -->
        </variant>
        
        <variant name="Large Dragon" id="large">
            <attr name="size" value="5" />
            <attr name="health" value="400" />
            <attr name="weight" value="210" /> <!-- in kilograms -->
        </variant>
    </variants>
</entitytype>