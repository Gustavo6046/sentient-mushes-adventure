<?xml version="1.0"?>
<entitytype name="Player" id="player">
    <functions>
        <function name="player_special">
            import random
        
            def player_special(entity, player, args):
                place = ' '.join(args)
                
                if entity.place == place:
                    player.print_out("{}: You are already there!".format(entity), place=entity.place)
                    return False                    
                
                if not entity.world.find_place(place):
                    player.print_out("{}: No such place!".format(entity), place=entity.place)
                    return False
                    
                dmg = random.uniform(5, 15)
                player.print_out("{}: Performing the Velociraptor's run, at the expense of {} health.".format(entity, dmg), place=entity.place)
                    
                a = None
                    
                for _ in range(3):
                    if entity.place == place:
                        a = 2
                        break
                        
                    b = entity.call('pathmove', place, 0)
                    a = (a and min(a, b)) or b
                    
                entity.call('take_damage', dmg)
                return a
        </function>
    </functions>

    <base>
        <attr name="obituary" value="'{killer} dug a couple holes out of {victim} with his bare hands!'" />
        
        <!-- kinetic (movement & combat) attributes -->
        <attr name="speed" value="0.4" /> <!-- likelihood to evade enemy attacks, from 0 to 1 -->
        <attr name="moveSpeed" value="0.8" /> <!-- chance, from 0 to 1, for a succesful tile move -->
        <attr name="isPlayer" value="True" />
    </base>
    
    <default>
        <attribute name="mush" value="True" />
        
        <import name="player" href="attributes/player.xml" />
    </default>
    
    <systems>
        <system name="pinata_drops" href="systems/pinata_drops.py" />
        <system name="drops" href="systems/drops.py" />
    </systems>
    
    <itemdefs>
        <!-- Materials -->
        <item name="stick" />
        <item name="pebble" />
        <item name="flint" />
        <item name="leaf" />
        <item name="straw" />
        
        <item name="rope">
            <flag name="craftable" />
            <attribute key="recipe" value="{ 'stray': 3 }" />
        </item>
        
        <item name="plank">
            <flag name="craftable" />
            <attribute key="recipe" value="{ 'stick': 5 }" />
            <attribute key="prerequisites" value="set('flint')" /> <!-- ingredients that aren't consumed in the process -->
        </item>
        
        <!-- Weapons -->
        <item name="flint sword">
            <flag name="weapon" />
            <attribute key="uses" value="70" />
            <attribute key="minDamage" value="30" />
            <attribute key="maxDamage" value="80" />
            <attribute key="recipe" value="{ 'stick': 2, 'flint': 1, 'straw': 3 }" />
        </item>
        
        <item name="poisonous flint sword">
            <flag name="weapon" />
            <attribute key="poison" value="3" />
            <attribute key="uses" value="70" />
            <attribute key="minDamage" value="40" />
            <attribute key="maxDamage" value="60" />
            <attribute key="recipe" value="{ 'flint sword': 1, 'poison sac': 1 }" />
        </item>
        
        <item name="steel sword">
            <flag name="weapon" />
            <attribute key="uses" value="125" />
            <attribute key="minDamage" value="40" />
            <attribute key="maxDamage" value="95" />
        </item>
        
        <item name="grenades">
            <flag name="weapon" />
            <attribute key="uses" value="8" />
            <attribute key="minDamage" value="60" />
            <attribute key="maxDamage" value="250" />
        </item>
    </itemdefs>
    
    <variants>
        <variant name="Velociraptor Player" id="p_raptor">
            <attr name="size" value="0.9" />
            <attr name="health" value="90" />
            <attr name="weight" value="70" /> <!-- in kilograms -->
            <attr name="dangerousness" value="90" />
            <attr name="punchDamage" value="20" /> <!-- would've been called lacerateDamage or slashDamage -->
            <attr name="obituary" value="&quot;{victim} was teared in plural parts by {killer}'s velociraptor claws!&quot;" />
        </variant>
    </variants>
</entitytype>